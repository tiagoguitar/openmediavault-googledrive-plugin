version: "1.0"
type: component
data:
  name: "omv-services-googledrive-page"
  type: "tabsPage"
  config:
    tabs:
      - text: "Settings"
        component: "omv-services-googledrive-settings-tab"
      - text: "Files"
        component: "omv-services-googledrive-files-tab"
---
version: "1.0"
type: component
data:
  name: "omv-services-googledrive-settings-tab"
  type: "formPage"
  config:
    request:
      service: "GoogleDrive"
      get:
        method: "isAuthenticated"
    fields:
      - type: "container"
        fields:
          - type: "paragraph"
            text: "Configure your Google Drive integration settings. First, ensure you have uploaded your client_secret.json file to /etc/openmediavault/googledrive/ directory."
          - type: "button"
            name: "authenticate"
            text: "Get Authentication URL"
            request:
              service: "GoogleDrive"
              method: "getAuthUrl"
              progressMessage: "Getting authentication URL..."
              successNotification: "Authentication URL generated. Please copy the URL from the response and open it in your browser."
          - type: "textInput"
            name: "authCode"
            label: "Authorization Code"
            hint: "After authorizing the application in your browser, copy the authorization code here."
            validators:
              required: true
          - type: "button"
            name: "setAuthCode"
            text: "Complete Authentication"
            request:
              service: "GoogleDrive"
              method: "setAuthCode"
              params:
                authCode: "{{ authCode }}"
              progressMessage: "Setting authorization code..."
              successNotification: "Authentication completed successfully!"
              errorNotification: "Authentication failed. Please check the authorization code."
---
version: "1.0"
type: component
data:
  name: "omv-services-googledrive-files-tab"
  type: "datatable"
  config:
    autoReload: true
    hasSearchField: true
    hasHeader: true
    selectionType: "single"
    columns:
      - name: "name"
        text: "Name"
        sortable: true
        flexGrow: 2
      - name: "mimeType"
        text: "Type"
        sortable: true
        flexGrow: 1
      - name: "size"
        text: "Size"
        sortable: true
        cellTemplateName: "binaryUnit"
        flexGrow: 1
      - name: "modifiedTime"
        text: "Modified"
        sortable: true
        cellTemplateName: "localeDateTime"
        flexGrow: 1
    store:
      proxy:
        service: "GoogleDrive"
        get:
          method: "listFiles"
    actions:
      - type: "iconButton"
        icon: "download"
        tooltip: "Download to /tmp"
        enabledBy: "_selected.length === 1"
        execute:
          type: "request"
          request:
            service: "GoogleDrive"
            method: "downloadFile"
            params:
              fileId: "{{ _selected[0].id }}"
              outputPath: "/tmp/{{ _selected[0].name }}"
            progressMessage: "Downloading file..."
            successNotification: "File downloaded to /tmp/{{ _selected[0].name }}"
            errorNotification: "Failed to download file."
      - type: "iconButton"
        icon: "delete"
        tooltip: "Delete from Google Drive"
        enabledBy: "_selected.length === 1"
        confirmationDialogConfig:
          template: "confirmation"
          message: "Do you really want to delete the selected file from Google Drive? This action is irreversible."
        execute:
          type: "request"
          request:
            service: "GoogleDrive"
            method: "deleteFile"
            params:
              fileId: "{{ _selected[0].id }}"
            progressMessage: "Deleting file..."
            successNotification: "File deleted successfully."
            errorNotification: "Failed to delete file."

